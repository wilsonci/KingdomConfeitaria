<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.web>
    <compilation debug="true" targetFramework="4.8">
      <assemblies>
        <add assembly="System.Web.Extensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
        <add assembly="System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />
      </assemblies>
    </compilation>
    <httpRuntime targetFramework="4.8" requestValidationMode="2.0" enableVersionHeader="false" maxRequestLength="51200" executionTimeout="300" />
    <globalization requestEncoding="utf-8" responseEncoding="utf-8" culture="pt-BR" uiCulture="pt-BR" />
    <pages enableViewStateMac="true" viewStateEncryptionMode="Auto" enableEventValidation="true" validateRequest="true">
      <controls>
        <add tagPrefix="asp" namespace="System.Web.UI" assembly="System.Web.Extensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
      </controls>
    </pages>
    <authentication mode="None" />
    <customErrors mode="Off" defaultRedirect="~/Error.aspx">
      <error statusCode="404" redirect="~/Error.aspx?code=404" />
      <error statusCode="500" redirect="~/Error.aspx?code=500" />
    </customErrors>
    <sessionState 
        mode="InProc" 
        timeout="30" 
        cookieless="false" 
        regenerateExpiredSessionId="true"
        cookieName="ASP.NET_SessionId" />
    <httpCookies httpOnlyCookies="true" requireSSL="false" sameSite="Lax" />
    <trace enabled="false" pageOutput="false" requestLimit="40" localOnly="true" />
    <trust level="Full" />
  </system.web>
  <connectionStrings>
    <!-- CONFIGURAÇÃO DE DESENVOLVIMENTO -->
    <!-- Banco de dados local para desenvolvimento e testes -->
    <!-- Arquivos do banco serão salvos em: App_Data\KingdomConfeitaria_Dev.mdf -->
    <add name="KingdomConfeitariaDB" 
         connectionString="Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\KingdomConfeitaria_Dev.mdf;Initial Catalog=KingdomConfeitaria_Dev;Integrated Security=True;Connect Timeout=30;MultipleActiveResultSets=True" 
         providerName="System.Data.SqlClient" />
  </connectionStrings>
  <appSettings>
    <!-- Ambiente: Development ou Production -->
    <add key="Environment" value="Development" />
    
    <!-- Configurações SMTP Gmail -->
    <add key="SmtpServer" value="smtp.gmail.com" />
    <add key="SmtpPort" value="587" />
    <add key="SmtpUsername" value="kingdomconfeitaria@gmail.com" />
    <!-- IMPORTANTE: Para Gmail, é necessário usar uma "Senha de App" (App Password) em vez da senha normal da conta.
         Para gerar uma Senha de App:
         1. Acesse: https://myaccount.google.com/apppasswords
         2. Selecione "Aplicativo" e "Outro (nome personalizado)"
         3. Digite "Kingdom Confeitaria" e clique em "Gerar"
         4. Copie a senha gerada (16 caracteres) e use aqui
         Se a senha normal não funcionar, substitua pelo valor da Senha de App gerada
         
         NOTA: A senha está criptografada usando AES. Para criptografar uma nova senha, use o utilitário
         Utils/EncryptPassword.aspx ou a classe Security.PasswordEncryption.Encrypt() -->
    <add key="SmtpPassword" value="WaNi5IdwRTB5FCiVRmbo1Bui1huwNuaTcINmTBMSF34=" />
    <add key="EmailIsabela" value="kingdomconfeitaria@gmail.com" />
    <add key="EmailCamila" value="kingdomconfeitaria@gmail.com" />
    <add key="EmailFrom" value="kingdomconfeitaria@gmail.com" />
    
    <!-- URL Base - Desenvolvimento -->
    <add key="BaseUrl" value="http://localhost" />
    
    <!-- Configurações WhatsApp (opcional) -->
    <add key="WhatsAppApiUrl" value="" />
    <add key="WhatsAppApiKey" value="" />
    <add key="WhatsAppPhoneNumber" value="" />
  </appSettings>
  <system.webServer>
    <defaultDocument enabled="true">
      <files>
        <clear />
        <add value="Default.aspx" />
      </files>
    </defaultDocument>
    <urlCompression doStaticCompression="true" doDynamicCompression="true" />
    <httpProtocol>
      <customHeaders>
        <!-- Proteção contra clickjacking -->
        <add name="X-Frame-Options" value="SAMEORIGIN" />
        <!-- Prevenir MIME type sniffing -->
        <add name="X-Content-Type-Options" value="nosniff" />
        <!-- XSS Protection -->
        <add name="X-XSS-Protection" value="1; mode=block" />
        <!-- Referrer Policy -->
        <add name="Referrer-Policy" value="strict-origin-when-cross-origin" />
        <!-- Content Security Policy -->
        <add name="Content-Security-Policy" value="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; img-src 'self' data: https:; font-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; connect-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com *.axd; frame-ancestors 'self';" />
        <!-- Permissions Policy -->
        <add name="Permissions-Policy" value="geolocation=(), microphone=(), camera=()" />
      </customHeaders>
    </httpProtocol>
    <security>
      <requestFiltering>
        <!-- Limitar tamanho de requisição -->
        <requestLimits maxAllowedContentLength="52428800" />
        <!-- Bloquear extensões perigosas -->
        <fileExtensions>
          <remove fileExtension=".exe" />
          <remove fileExtension=".dll" />
          <remove fileExtension=".bat" />
          <remove fileExtension=".cmd" />
          <remove fileExtension=".com" />
          <remove fileExtension=".vbs" />
          <remove fileExtension=".js" />
          <remove fileExtension=".jsp" />
          <remove fileExtension=".php" />
          <remove fileExtension=".asp" />
          <remove fileExtension=".aspx" />
          <remove fileExtension=".ashx" />
        </fileExtensions>
        <!-- Bloquear sequências perigosas -->
        <denyUrlSequences>
          <add sequence=".." />
          <add sequence="\.\." />
          <add sequence="%2e%2e" />
          <add sequence="%2f" />
          <add sequence="%5c" />
        </denyUrlSequences>
      </requestFiltering>
    </security>
    <modules>
      <add name="SecurityHeadersModule" type="KingdomConfeitaria.Security.SecurityHeadersModule" />
    </modules>
    <rewrite>
      <rules>
        <!-- Forçar HTTPS em produção (descomente quando tiver SSL) -->
        <!--
        <rule name="Force HTTPS" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
            <add input="{HTTPS}" pattern="off" />
          </conditions>
          <action type="Redirect" url="https://{HTTP_HOST}/{R:1}" redirectType="Permanent" />
        </rule>
        -->
      </rules>
    </rewrite>
  </system.webServer>
</configuration>

